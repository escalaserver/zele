<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z'ele Church - Escalas</title>
    <meta name="application-name" content="Z'ele Church">
    <meta name="apple-mobile-web-app-title" content="Z'ele Church">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#151b29">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlonZWxlIENodXJjaCAtIEVzY2FsYXMiLAogICJzaG9ydF9uYW1lIjogIlonZWxlIEVzY2FsYXMiLAogICJkZXNjcmlwdGlvbiI6ICJTZXJ2aXIgw6kgYSBsaW5ndWFnZW0gZG8gY8OpdSIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2NkYzhjMCIsCiAgInRoZW1lX2NvbG9yIjogIiMxNTFiMjkiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2dpdGh1Yi5jb20vVm9sdW50ZWVyc1plbGUvZXNjYWxhL2Jsb2IvbWFpbi9Wb2x1bnRlZXJzJTIwbG9nby5wbmc/cmF3PXRydWUiLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIsCiAgICAgICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9naXRodWIuY29tL1ZvbHVudGVlcnNaZWxlL2VzY2FsYS9ibG9iL21haW4vVm9sdW50ZWVycyUyMGxvZ28ucG5nP3Jhdz10cnVlIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9CiAgXQp9">
    <link rel="apple-touch-icon" href="https://github.com/VolunteersZele/escala/blob/main/Volunteers%20logo.png?raw=true">
    <link rel="icon" type="image/png" href="https://github.com/VolunteersZele/escala/blob/main/Volunteers%20logo.png?raw=true">
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, query, where, getDocs, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBGMYUmA0hJs1v2IlU-fdFDucYFp6LZaCg",
            authDomain: "z-ele-church-escalas.firebaseapp.com",
            projectId: "z-ele-church-escalas",
            storageBucket: "z-ele-church-escalas.firebasestorage.app",
            messagingSenderId: "473523773124",
            appId: "1:473523773124:web:9c57a51236a5a8fabc3391"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        // For√ßar sele√ß√£o de conta ao fazer login
        provider.setCustomParameters({
            prompt: 'select_account'
        });
        
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseProvider = provider;
        window.firebaseAuthMethods = { signInWithPopup, signOut, onAuthStateChanged };
        window.firestoreMethods = { doc, setDoc, getDoc, onSnapshot, collection, query, where, getDocs, deleteDoc };
        
        console.log('‚úÖ Firebase inicializado e exportado para window');
        window.firebaseReady = true;
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; background-color: #cdc8c0; }
        .zele-primary { background-color: #151b29; }
        .zele-secondary { background-color: #151b29; }
        .zele-secondary-hover:hover { background-color: #1f2937; }
        .zele-tertiary { background-color: #cdc8c0; }
        .zele-btn {
            background-color: #151b29;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2);
            border: 1px solid #e5e5e5;
            transition: all 0.2s ease;
        }
        .zele-btn:hover {
            background-color: #1f2937;
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.4), 0 2px 4px rgba(0, 0, 0, 0.25);
            transform: translateY(-2px);
        }
        .zele-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .card-float {
            background-color: white;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            border: 2px solid #e5e5e5;
        }
        .modal-overlay { 
            display: none; 
            position: fixed; 
            inset: 0; 
            background-color: rgba(0, 0, 0, 0.5); 
            z-index: 9999; 
            align-items: center; 
            justify-content: center;
        }
        .modal-overlay.show { display: flex; }
        .menu-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9998;
        }
        .menu-overlay.show { display: block; }
        .menu-drawer {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: white;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.3);
            transition: right 0.3s ease;
            z-index: 9999;
            overflow-y: auto;
        }
        .menu-drawer.show { right: 0; }
        .team-btn {
            background-color: #151b29;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2);
            border: 1px solid #e5e5e5;
            transition: all 0.2s ease;
            padding: 0;
            overflow: hidden;
        }
        .team-btn:hover {
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.4), 0 2px 4px rgba(0, 0, 0, 0.25);
            transform: translateY(-2px);
        }
        .team-btn.selected {
            background-color: #377db8;
            border-color: #377db8;
            box-shadow: 0 0 0 3px rgba(55, 125, 184, 0.3);
        }
        .team-btn img {
            width: 100%;
            height: auto;
            display: block;
        }
        @keyframes blink-border {
            0%, 100% { box-shadow: 0 0 0 0px #377db8; }
            50% { box-shadow: 0 0 0 4px #377db8; }
        }
        .blink-border {
            animation: blink-border 0.5s ease-in-out 3;
        }
    </style>
</head>
<body style="background-color: #cdc8c0;">
    
    <!-- Tela de Loading -->
    <div id="loading-screen" class="fixed inset-0 zele-primary flex items-center justify-center z-50">
        <div class="text-center text-white">
            <img src="https://github.com/VolunteersZele/escala/blob/main/Volunteers%20logo.png?raw=true" alt="Z'ele Church" class="w-32 h-32 mx-auto mb-4 object-contain">
            <h1 class="text-5xl font-bold mb-4">Z'ele Church</h1>
            <p class="text-xl mb-8">Escalas de Volunt√°rios</p>
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-white mx-auto"></div>
        </div>
    </div>

    <!-- Tela de Login -->
    <div id="auth-screen" class="fixed inset-0 zele-primary flex items-center justify-center p-4 hidden">
        <div class="card-float rounded-2xl p-8 max-w-md w-full text-center">
            <img src="https://github.com/VolunteersZele/escala/blob/main/Volunteers%20logo.png?raw=true" alt="Z'ele Church" class="w-24 h-24 mx-auto mb-4 object-contain">
            <h1 class="text-4xl font-bold mb-2" style="color: #151b29;">Z'ele Church</h1>
            <p class="text-gray-600 mb-8">Sistema de Escalas</p>
            <button id="google-login-btn" class="w-full zele-btn text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center gap-3">
                <svg class="w-6 h-6" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Entrar com Google
            </button>
        </div>
    </div>

    <!-- App Principal -->
    <div id="app-container" class="hidden">
        <!-- Header -->
        <header class="zele-primary text-white" style="box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <img src="https://github.com/VolunteersZele/escala/blob/main/Volunteers%20logo.png?raw=true" alt="Logo" class="w-10 h-10 object-contain">
                        <h1 class="text-2xl font-bold">Z'ele Church</h1>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right hidden sm:block">
                            <p class="text-sm font-semibold" id="user-name">Usu√°rio</p>
                            <p class="text-xs opacity-90" id="user-email">email@example.com</p>
                        </div>
                        <img id="user-photo" src="" alt="Foto" class="w-10 h-10 rounded-full border-2 border-white">
                        <button id="menu-btn" class="zele-btn p-2 rounded-lg">
                            <svg class="w-6 h-6" fill="none" stroke="white" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Conte√∫do Principal -->
        <main class="container mx-auto px-4 py-8 max-w-6xl">
            
            <!-- Criar Nova Escala -->
            <div class="card-float rounded-xl p-6 mb-8">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold mb-1" style="color: #151b29;">Escolha seu dia de servir</h2>
                    <p class="text-sm text-gray-600 mb-3">Comece escolhendo o dia na lista</p>
                    <select id="culto-select" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 text-base" style="--tw-ring-color: #151b29; border-color: #e5e5e5;">
                        <option value="">Escolha uma data...</option>
                        <option value="2025-11-20|19:00|Quinta">20/11 Quinta (chegar 19h)</option>
                        <option value="2025-11-23|09:00|Domingo">23/11 Domingo (chegar 09h)</option>
                        <option value="2025-11-27|19:00|Quinta">27/11 Quinta (chegar 19h)</option>
                        <option value="2025-11-30|09:00|Domingo">30/11 Domingo (chegar 09h)</option>
                        <option value="2025-12-04|19:00|Quinta">04/12 Quinta (chegar 19h)</option>
                        <option value="2025-12-07|09:00|Domingo">07/12 Domingo (chegar 09h)</option>
                        <option value="2025-12-11|19:00|Quinta - Pr√© Inaugura√ß√£o">11/12 Quinta | Pr√© Inaugura√ß√£o (chegar 19h)</option>
                        <option value="2025-12-12|19:00|Sexta - Ensaio Geral">12/12 Sexta | Ensaio Geral (chegar 19h)</option>
                        <option value="2025-12-13|00:00|S√°bado - Inaugura√ß√£o">13/12 S√°bado | Inaugura√ß√£o (hor√°rio a definir)</option>
                        <option value="2025-12-14|09:00|Domingo - Batismo">14/12 Domingo | Batismo (chegar 9h)</option>
                        <option value="2025-12-18|19:00|Quinta do Encontro">18/12 Quinta do Encontro (chegar 19h)</option>
                        <option value="2025-12-21|09:00|Domingo">21/12 Culto de Domingo (chegar 09h)</option>
                        <option value="2025-12-25|19:00|Quinta - Natal">25/12 Quinta (chegar 19h)</option>
                        <option value="2025-12-28|09:00|Domingo">28/12 Domingo (chegar 09h)</option>
                        <option value="2025-12-31|00:00|Culto da Virada">31/12 Culto da Virada (hor√°rio a definir)</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2" style="color: #151b29;">Em qual equipe voc√™ vai servir nesta data?</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <button class="team-btn rounded-lg" data-team="welcome" 
                                data-img-normal="https://github.com/VolunteersZele/escala/blob/main/Logo%20Welcome%20horizontal.png?raw=true"
                                data-img-selected="https://github.com/VolunteersZele/escala/blob/main/Welcome%20azul%20claro.png?raw=true">
                            <img src="https://github.com/VolunteersZele/escala/blob/main/Logo%20Welcome%20horizontal.png?raw=true" alt="Welcome">
                        </button>
                        <button class="team-btn rounded-lg" data-team="backstage"
                                data-img-normal="https://github.com/VolunteersZele/escala/blob/main/Logo%20Backstage%20horizontal.png?raw=true"
                                data-img-selected="https://github.com/VolunteersZele/escala/blob/main/Backstage%20azul%20claro.png?raw=true">
                            <img src="https://github.com/VolunteersZele/escala/blob/main/Logo%20Backstage%20horizontal.png?raw=true" alt="Backstage">
                        </button>
                        <button class="team-btn rounded-lg" data-team="parking"
                                data-img-normal="https://github.com/VolunteersZele/escala/blob/main/Logo%20Parking%20horizontal.png?raw=true"
                                data-img-selected="https://github.com/VolunteersZele/escala/blob/main/Parking%20azul%20claro.png?raw=true">
                            <img src="https://github.com/VolunteersZele/escala/blob/main/Logo%20Parking%20horizontal.png?raw=true" alt="Parking">
                        </button>
                        <button class="team-btn rounded-lg" data-team="kids"
                                data-img-normal="https://github.com/VolunteersZele/escala/blob/main/Logo%20Kids%20horizontal.png?raw=true"
                                data-img-selected="https://github.com/VolunteersZele/escala/blob/main/Kids%20azul%20claro.png?raw=true">
                            <img src="https://github.com/VolunteersZele/escala/blob/main/Logo%20Kids%20horizontal.png?raw=true" alt="Kids">
                        </button>
                    </div>
                </div>

                <button id="save-escala-btn" class="w-full zele-btn text-white font-bold py-3 px-6 rounded-lg mt-4">
                    üíæ Salvar Escala
                </button>
            </div>

            <!-- Calend√°rio/Lista de Escalas -->
            <div class="card-float rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold" style="color: #151b29;">üìÖ Minhas Escalas</h2>
                    <select id="filter-minhas-escalas" class="border border-gray-300 rounded-lg px-3 py-2 text-sm" style="border-color: #e5e5e5;">
                        <option value="">Todas as datas</option>
                    </select>
                </div>
                <div id="escalas-list" class="space-y-4">
                    <!-- Escalas ser√£o inseridas aqui -->
                </div>
            </div>

            <!-- Vis√£o Geral (Admin) -->
            <div class="card-float rounded-xl p-6 mt-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold" style="color: #151b29;">üë• Vis√£o Geral dos Times</h2>
                    <select id="filter-visao-geral" class="border border-gray-300 rounded-lg px-3 py-2 text-sm" style="border-color: #e5e5e5;">
                        <option value="">Todas as datas</option>
                    </select>
                </div>
                <div id="admin-view" class="space-y-4">
                    <!-- Vis√£o geral ser√° inserida aqui -->
                </div>
            </div>

        </main>
    </div>

    <!-- Menu Lateral -->
    <div id="menu-overlay" class="menu-overlay"></div>
    <div id="menu-drawer" class="menu-drawer">
        <div class="p-6">
            <!-- Header do Menu -->
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <img src="https://github.com/VolunteersZele/escala/blob/main/Volunteers%20logo.png?raw=true" alt="Logo" class="w-12 h-12 object-contain">
                    <h2 class="text-xl font-bold" style="color: #151b29;">Menu</h2>
                </div>
                <button id="menu-close-btn" class="text-gray-600 hover:text-gray-800">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- User Info -->
            <div class="mb-6 pb-6 border-b border-gray-200">
                <div class="flex items-center gap-3">
                    <img id="menu-user-photo" src="" alt="Foto" class="w-16 h-16 rounded-full">
                    <div>
                        <p class="font-semibold text-gray-800" id="menu-user-name">Usu√°rio</p>
                        <p class="text-sm text-gray-600" id="menu-user-email">email@example.com</p>
                    </div>
                </div>
            </div>

            <!-- Menu Items -->
            <div class="space-y-2">
                <button id="install-app-btn" class="w-full flex items-center gap-3 p-4 rounded-lg hover:bg-gray-100 transition text-left" style="display: none;">
                    <svg class="w-6 h-6" style="color: #151b29;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    <div>
                        <p class="font-semibold text-gray-800">Instalar App</p>
                        <p class="text-xs text-gray-600">Adicionar √† tela inicial</p>
                    </div>
                </button>

                <button id="menu-logout-btn" class="w-full flex items-center gap-3 p-4 rounded-lg hover:bg-gray-100 transition text-left">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                    <div>
                        <p class="font-semibold text-gray-800">Sair</p>
                        <p class="text-xs text-gray-600">Fazer logout</p>
                    </div>
                </button>
            </div>

            <!-- Vers√£o -->
            <div class="mt-8 pt-6 border-t border-gray-200 text-center text-xs text-gray-500">
                <p>Z'ele Church Escalas v1.0</p>
                <p class="mt-1">Servir √© a linguagem do c√©u</p>
            </div>
        </div>
    </div>

    <!-- Modal de Sucesso -->
    <div id="success-modal" class="modal-overlay">
        <div class="card-float rounded-2xl p-8 max-w-md w-full mx-4 text-center">
            <div class="mb-4 text-6xl">‚úÖ</div>
            <h2 class="text-2xl font-bold mb-2" style="color: #151b29;">Volunteers</h2>
            <p class="text-gray-600 mb-6" id="modal-message">Escala salva com sucesso!</p>
            <div id="modal-buttons" class="flex gap-3">
                <button id="modal-close-btn" class="flex-1 zele-btn text-white font-bold py-3 px-6 rounded-lg">
                    OK
                </button>
            </div>
        </div>
    </div>

    <script>
        // Aguardar Firebase estar pronto
        function initApp() {
            console.log('üöÄ App iniciando...');
            
            // Verificar se Firebase foi inicializado
            if (!window.firebaseAuth || !window.firebaseDb) {
                console.error('‚ùå Firebase n√£o inicializado, tentando novamente...');
                setTimeout(initApp, 100);
                return;
            }
            
            console.log('‚úÖ Firebase Auth:', window.firebaseAuth);
            console.log('‚úÖ Firebase DB:', window.firebaseDb);
            console.log('‚úÖ Firebase Provider:', window.firebaseProvider);
            
            let currentUser = null;
            let selectedTeam = null;
            
            // Pr√©-carregar todas as imagens dos times
            const preloadedImages = {};
            function preloadTeamImages() {
                const imageUrls = [
                    'https://github.com/VolunteersZele/escala/blob/main/Logo%20Welcome%20horizontal.png?raw=true',
                    'https://github.com/VolunteersZele/escala/blob/main/Welcome%20azul%20claro.png?raw=true',
                    'https://github.com/VolunteersZele/escala/blob/main/Logo%20Backstage%20horizontal.png?raw=true',
                    'https://github.com/VolunteersZele/escala/blob/main/Backstage%20azul%20claro.png?raw=true',
                    'https://github.com/VolunteersZele/escala/blob/main/Logo%20Parking%20horizontal.png?raw=true',
                    'https://github.com/VolunteersZele/escala/blob/main/Parking%20azul%20claro.png?raw=true',
                    'https://github.com/VolunteersZele/escala/blob/main/Logo%20Kids%20horizontal.png?raw=true',
                    'https://github.com/VolunteersZele/escala/blob/main/Kids%20azul%20claro.png?raw=true'
                ];
                
                imageUrls.forEach(url => {
                    const img = new Image();
                    img.src = url;
                    preloadedImages[url] = img;
                });
                
                console.log('‚úÖ Imagens dos times pr√©-carregadas');
            }
            
            // Chamar pr√©-carregamento assim que o app iniciar
            preloadTeamImages();
            
            // Elementos DOM
            const elements = {
                loadingScreen: document.getElementById('loading-screen'),
                authScreen: document.getElementById('auth-screen'),
                appContainer: document.getElementById('app-container'),
                googleLoginBtn: document.getElementById('google-login-btn'),
                menuBtn: document.getElementById('menu-btn'),
                menuOverlay: document.getElementById('menu-overlay'),
                menuDrawer: document.getElementById('menu-drawer'),
                menuCloseBtn: document.getElementById('menu-close-btn'),
                menuLogoutBtn: document.getElementById('menu-logout-btn'),
                installAppBtn: document.getElementById('install-app-btn'),
                menuUserName: document.getElementById('menu-user-name'),
                menuUserEmail: document.getElementById('menu-user-email'),
                menuUserPhoto: document.getElementById('menu-user-photo'),
                userName: document.getElementById('user-name'),
                userEmail: document.getElementById('user-email'),
                userPhoto: document.getElementById('user-photo'),
                cultoSelect: document.getElementById('culto-select'),
                saveEscalaBtn: document.getElementById('save-escala-btn'),
                escalasList: document.getElementById('escalas-list'),
                adminView: document.getElementById('admin-view'),
                teamBtns: document.querySelectorAll('.team-btn'),
                successModal: document.getElementById('success-modal'),
                modalMessage: document.getElementById('modal-message'),
                modalButtons: document.getElementById('modal-buttons'),
                modalCloseBtn: document.getElementById('modal-close-btn'),
                filterMinhasEscalas: document.getElementById('filter-minhas-escalas'),
                filterVisaoGeral: document.getElementById('filter-visao-geral')
            };
            
            // Vari√°veis para armazenar dados completos
            let allUserEscalas = [];
            let allEscalasGrouped = {};

            // Modal functions
            function showModal(message, showYesNo = false, onYes = null, isWarning = false, onClose = null) {
                elements.modalMessage.textContent = message;
                
                // Mudar emoji baseado no tipo de modal
                const emojiDiv = elements.successModal.querySelector('.mb-4');
                if (isWarning) {
                    emojiDiv.textContent = '‚ö†Ô∏è';
                } else {
                    emojiDiv.textContent = '‚úÖ';
                }
                
                if (showYesNo && onYes) {
                    // Modal com Sim/N√£o
                    elements.modalButtons.innerHTML = `
                        <button id="modal-no-btn" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-lg transition">
                            N√£o
                        </button>
                        <button id="modal-yes-btn" class="flex-1 zele-btn text-white font-bold py-3 px-6 rounded-lg">
                            Sim
                        </button>
                    `;
                    
                    document.getElementById('modal-yes-btn').addEventListener('click', () => {
                        closeModal();
                        onYes();
                    });
                    
                    document.getElementById('modal-no-btn').addEventListener('click', () => {
                        closeModal();
                        if (onClose) onClose();
                    });
                } else {
                    // Modal apenas com OK
                    elements.modalButtons.innerHTML = `
                        <button id="modal-close-btn" class="flex-1 zele-btn text-white font-bold py-3 px-6 rounded-lg">
                            OK
                        </button>
                    `;
                    
                    document.getElementById('modal-close-btn').addEventListener('click', () => {
                        closeModal();
                        if (onClose) onClose();
                    });
                }
                
                elements.successModal.classList.add('show');
            }

            function closeModal() {
                elements.successModal.classList.remove('show');
            }

            elements.successModal.addEventListener('click', (e) => {
                if (e.target === elements.successModal) {
                    closeModal();
                }
            });

            // Menu functions
            function openMenu() {
                elements.menuOverlay.classList.add('show');
                elements.menuDrawer.classList.add('show');
            }

            function closeMenu() {
                elements.menuOverlay.classList.remove('show');
                elements.menuDrawer.classList.remove('show');
            }

            elements.menuBtn.addEventListener('click', openMenu);
            elements.menuCloseBtn.addEventListener('click', closeMenu);
            elements.menuOverlay.addEventListener('click', closeMenu);
            elements.menuLogoutBtn.addEventListener('click', () => {
                closeMenu();
                logout();
            });

            // PWA Install
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                elements.installAppBtn.style.display = 'block';
            });

            elements.installAppBtn.addEventListener('click', async () => {
                if (!deferredPrompt) {
                    showModal('App j√° est√° instalado ou n√£o pode ser instalado neste dispositivo.');
                    return;
                }

                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    showModal('App instalado com sucesso!');
                    elements.installAppBtn.style.display = 'none';
                }
                
                deferredPrompt = null;
                closeMenu();
            });

            // Sele√ß√£o de time
            elements.teamBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Verificar se uma data foi selecionada
                    if (!elements.cultoSelect.value) {
                        // Mostrar modal de alerta com callback para piscar ap√≥s fechar
                        showModal(
                            'Escolha o dia para depois selecionar a equipe que vai servir', 
                            false, 
                            null, 
                            true,
                            () => {
                                // Piscar a borda do select ap√≥s fechar o modal
                                elements.cultoSelect.classList.add('blink-border');
                                setTimeout(() => {
                                    elements.cultoSelect.classList.remove('blink-border');
                                }, 1500); // 3 piscadas x 0.5s = 1.5s
                            }
                        );
                        
                        return;
                    }
                    
                    // Resetar todos os bot√µes para imagem normal
                    elements.teamBtns.forEach(b => {
                        b.classList.remove('selected');
                        const img = b.querySelector('img');
                        const normalImg = b.dataset.imgNormal;
                        if (img && normalImg) {
                            img.src = normalImg;
                        }
                    });
                    
                    // Marcar bot√£o clicado como selecionado e trocar imagem
                    btn.classList.add('selected');
                    const img = btn.querySelector('img');
                    const selectedImg = btn.dataset.imgSelected;
                    if (img && selectedImg) {
                        img.src = selectedImg;
                    }
                    
                    selectedTeam = btn.dataset.team;
                });
            });

            // Resetar sele√ß√£o de time quando trocar o culto
            elements.cultoSelect.addEventListener('change', () => {
                if (selectedTeam) {
                    // Resetar todos os bot√µes para imagem normal
                    elements.teamBtns.forEach(btn => {
                        btn.classList.remove('selected');
                        const img = btn.querySelector('img');
                        const normalImg = btn.dataset.imgNormal;
                        if (img && normalImg) {
                            img.src = normalImg;
                        }
                    });
                    selectedTeam = null;
                }
            });

            // Login com Google
            async function loginWithGoogle() {
                try {
                    console.log('üîê Iniciando login...');
                    console.log('Auth:', window.firebaseAuth);
                    console.log('Provider:', window.firebaseProvider);
                    const result = await window.firebaseAuthMethods.signInWithPopup(window.firebaseAuth, window.firebaseProvider);
                    currentUser = result.user;
                    console.log('‚úÖ Login bem-sucedido:', currentUser.email);
                } catch (error) {
                    console.error('‚ùå Erro no login:', error);
                    console.error('C√≥digo do erro:', error.code);
                    console.error('Mensagem:', error.message);
                    alert(`Erro ao fazer login: ${error.message}\n\nVerifique:\n1. Autentica√ß√£o Google habilitada no Firebase\n2. Dom√≠nio autorizado no Firebase Console\n3. Conex√£o com internet`);
                }
            }

            // Logout
            async function logout() {
                try {
                    await window.firebaseAuthMethods.signOut(window.firebaseAuth);
                    console.log('üëã Logout realizado');
                    // Recarregar a p√°gina para limpar o estado e voltar para tela de login
                    window.location.reload();
                } catch (error) {
                    console.error('‚ùå Erro no logout:', error);
                }
            }

            // Atualizar UI do usu√°rio
            function updateUserUI(user) {
                if (user) {
                    elements.userName.textContent = user.displayName || 'Usu√°rio';
                    elements.userEmail.textContent = user.email;
                    elements.userPhoto.src = user.photoURL || '';
                    elements.menuUserName.textContent = user.displayName || 'Usu√°rio';
                    elements.menuUserEmail.textContent = user.email;
                    elements.menuUserPhoto.src = user.photoURL || '';
                }
            }

            // Mostrar app
            function showApp() {
                elements.loadingScreen.style.display = 'none';
                elements.authScreen.style.display = 'none';
                elements.appContainer.classList.remove('hidden');
            }

            // Mostrar tela de login
            function showLogin() {
                elements.loadingScreen.style.display = 'none';
                elements.authScreen.classList.remove('hidden');
                elements.appContainer.classList.add('hidden');
            }

            // Salvar escala
            async function saveEscala() {
                if (!currentUser) {
                    showModal('Voc√™ precisa estar logado!');
                    return;
                }

                const cultoData = elements.cultoSelect.value;
                const team = selectedTeam;

                if (!cultoData || !team) {
                    showModal('Por favor, selecione um culto e um time!');
                    return;
                }

                // Parsear os dados do culto (formato: "2024-11-20|19:00|Quinta")
                const [date, time, eventName] = cultoData.split('|');

                const teamNames = {
                    welcome: 'Welcome',
                    backstage: 'Backstage',
                    parking: 'Parking',
                    kids: 'Kids'
                };

                try {
                    // Verificar se j√° existe escala deste usu√°rio para esta data
                    const escalaId = `${currentUser.uid}_${date}`;
                    const { doc, getDoc, setDoc } = window.firestoreMethods;
                    
                    // Buscar escala existente
                    const docRef = doc(window.firebaseDb, 'escalas', escalaId);
                    const docSnap = await getDoc(docRef);
                    
                    if (docSnap.exists()) {
                        const existingTeam = docSnap.data().team;
                        
                        // Se for o mesmo time, apenas atualiza
                        if (existingTeam === team) {
                            // Mostrar confirma√ß√£o antes de salvar
                            showModal(
                                `Confirmar escala no time ${teamNames[team]}?`,
                                true,
                                async () => {
                                    await saveEscalaToFirestore(escalaId, date, time, team, eventName, true);
                                }
                            );
                        } else {
                            // Times diferentes - pedir confirma√ß√£o
                            showModal(
                                `Voc√™ j√° escolheu servir no time ${teamNames[existingTeam]}. Deseja confirmar a mudan√ßa para o time ${teamNames[team]} nesta escala?`,
                                true,
                                async () => {
                                    await saveEscalaToFirestore(escalaId, date, time, team, eventName, false);
                                }
                            );
                        }
                    } else {
                        // Nova escala - mostrar confirma√ß√£o
                        showModal(
                            `Confirmar escala no time ${teamNames[team]}?`,
                            true,
                            async () => {
                                await saveEscalaToFirestore(escalaId, date, time, team, eventName, false);
                            }
                        );
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erro ao salvar escala:', error);
                    showModal('Erro ao salvar escala. Tente novamente.');
                }
            }

            // Fun√ß√£o auxiliar para salvar no Firestore
            async function saveEscalaToFirestore(escalaId, date, time, team, eventName, skipCalendarPrompt) {
                try {
                    const { doc, setDoc } = window.firestoreMethods;
                    
                    await setDoc(doc(window.firebaseDb, 'escalas', escalaId), {
                        userId: currentUser.uid,
                        userName: currentUser.displayName,
                        userEmail: currentUser.email,
                        userPhoto: currentUser.photoURL,
                        date: date,
                        time: time,
                        team: team,
                        eventName: eventName || '',
                        createdAt: new Date().toISOString()
                    });

                    console.log('‚úÖ Escala salva com sucesso!');
                    
                    // Limpar sele√ß√£o e resetar imagens
                    selectedTeam = null;
                    elements.teamBtns.forEach(btn => {
                        btn.classList.remove('selected');
                        const img = btn.querySelector('img');
                        const normalImg = btn.dataset.imgNormal;
                        if (img && normalImg) {
                            img.src = normalImg;
                        }
                    });
                    elements.cultoSelect.value = '';
                    
                    // Recarregar escalas e atualizar dropdown
                    loadUserEscalas();
                    loadAllEscalas();
                    
                    // Mostrar confirma√ß√£o de sucesso
                    showModal('Escala salva com sucesso!');
                    
                } catch (error) {
                    console.error('‚ùå Erro ao salvar escala:', error);
                    showModal('Erro ao salvar escala. Tente novamente.');
                    throw error;
                }
            }

            // Exportar para Google Calendar
            function exportToGoogleCalendar(date, time, team, eventName) {
                const teamNames = {
                    welcome: 'Welcome',
                    backstage: 'Backstage',
                    parking: 'Parking',
                    kids: 'Kids'
                };

                const startDateTime = `${date}T${time}:00`;
                const endDate = new Date(`${date}T${time}:00`);
                endDate.setHours(endDate.getHours() + 2);
                const endDateTime = endDate.toISOString().slice(0, 16).replace('T', ' ').replace(' ', 'T');

                const title = `Z'ele Church - ${teamNames[team]}${eventName ? ' - ' + eventName : ''}`;
                const description = `Escala volunt√°ria no time ${teamNames[team]}${eventName ? '\\nEvento: ' + eventName : ''}`;
                const location = 'Z\'ele Church - Av. Jacu P√™ssego, 7639';

                const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${startDateTime.replace(/[-:]/g, '')}/${endDateTime.replace(/[-:]/g, '')}&details=${encodeURIComponent(description)}&location=${encodeURIComponent(location)}`;
                
                window.open(googleCalendarUrl, '_blank');
            }

            // Formatar data para ICS (formato: YYYYMMDDTHHmmss)
            function formatICSDate(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                const seconds = String(date.getSeconds()).padStart(2, '0');
                return `${year}${month}${day}T${hours}${minutes}${seconds}`;
            }

            // Carregar escalas do usu√°rio
            async function loadUserEscalas() {
                if (!currentUser) return;

                try {
                    const { collection, query, where, getDocs } = window.firestoreMethods;
                    const q = query(
                        collection(window.firebaseDb, 'escalas'),
                        where('userId', '==', currentUser.uid)
                    );
                    
                    const querySnapshot = await getDocs(q);
                    const escalas = [];
                    
                    querySnapshot.forEach((doc) => {
                        escalas.push({ id: doc.id, ...doc.data() });
                    });

                    // Ordenar por data
                    escalas.sort((a, b) => new Date(a.date) - new Date(b.date));

                    // Armazenar todas as escalas
                    allUserEscalas = escalas;
                    
                    // Atualizar filtro com datas dispon√≠veis
                    updateMinhasEscalasFilter(escalas);
                    
                    renderUserEscalas(escalas);
                    updateCultoDropdown(escalas);
                } catch (error) {
                    console.error('‚ùå Erro ao carregar escalas:', error);
                }
            }
            
            // Atualizar filtro de Minhas Escalas
            function updateMinhasEscalasFilter(escalas) {
                const filter = elements.filterMinhasEscalas;
                const uniqueDates = [...new Set(escalas.map(e => e.date))].sort();
                
                filter.innerHTML = '<option value="">Todas as datas</option>';
                
                uniqueDates.forEach(date => {
                    const dateObj = new Date(date + 'T12:00:00');
                    const dateStr = dateObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                    const option = document.createElement('option');
                    option.value = date;
                    option.textContent = dateStr;
                    filter.appendChild(option);
                });
            }
            
            // Event listener para filtro de Minhas Escalas
            elements.filterMinhasEscalas.addEventListener('change', () => {
                const selectedDate = elements.filterMinhasEscalas.value;
                if (selectedDate) {
                    const filtered = allUserEscalas.filter(e => e.date === selectedDate);
                    renderUserEscalas(filtered);
                } else {
                    renderUserEscalas(allUserEscalas);
                }
            });

            // Atualizar dropdown removendo datas j√° escaladas
            function updateCultoDropdown(escalas) {
                // Obter todas as op√ß√µes do select
                const select = elements.cultoSelect;
                const allOptions = [
                    { value: "", text: "Escolha uma data..." },
                    { value: "2025-11-20|19:00|Quinta", text: "20/11 Quinta (chegar 19h)" },
                    { value: "2025-11-23|09:00|Domingo", text: "23/11 Domingo (chegar 09h)" },
                    { value: "2025-11-27|19:00|Quinta", text: "27/11 Quinta (chegar 19h)" },
                    { value: "2025-11-30|09:00|Domingo", text: "30/11 Domingo (chegar 09h)" },
                    { value: "2025-12-04|19:00|Quinta", text: "04/12 Quinta (chegar 19h)" },
                    { value: "2025-12-07|09:00|Domingo", text: "07/12 Domingo (chegar 09h)" },
                    { value: "2025-12-11|19:00|Quinta - Pr√© Inaugura√ß√£o", text: "11/12 Quinta | Pr√© Inaugura√ß√£o (chegar 19h)" },
                    { value: "2025-12-12|19:00|Sexta - Ensaio Geral", text: "12/12 Sexta | Ensaio Geral (chegar 19h)" },
                    { value: "2025-12-13|00:00|S√°bado - Inaugura√ß√£o", text: "13/12 S√°bado | Inaugura√ß√£o (hor√°rio a definir)" },
                    { value: "2025-12-14|09:00|Domingo - Batismo", text: "14/12 Domingo | Batismo (chegar 9h)" },
                    { value: "2025-12-18|19:00|Quinta do Encontro", text: "18/12 Quinta do Encontro (chegar 19h)" },
                    { value: "2025-12-21|09:00|Domingo", text: "21/12 Culto de Domingo (chegar 09h)" },
                    { value: "2025-12-25|19:00|Quinta - Natal", text: "25/12 Quinta (chegar 19h)" },
                    { value: "2025-12-28|09:00|Domingo", text: "28/12 Domingo (chegar 09h)" },
                    { value: "2025-12-31|00:00|Culto da Virada", text: "31/12 Culto da Virada (hor√°rio a definir)" }
                ];

                // Criar set com datas j√° escaladas
                const escaladasDates = new Set(escalas.map(e => e.date));

                // Limpar select
                select.innerHTML = '';

                // Adicionar apenas op√ß√µes n√£o escaladas
                allOptions.forEach(option => {
                    if (option.value === "" || !escaladasDates.has(option.value.split('|')[0])) {
                        const optionElement = document.createElement('option');
                        optionElement.value = option.value;
                        optionElement.textContent = option.text;
                        select.appendChild(optionElement);
                    }
                });

                // Se n√£o houver mais datas dispon√≠veis
                if (select.options.length === 1) {
                    select.innerHTML = '<option value="">Todas as datas j√° est√£o escaladas</option>';
                    select.disabled = true;
                } else {
                    select.disabled = false;
                }
            }

            // Renderizar escalas do usu√°rio
            function renderUserEscalas(escalas) {
                const teamConfig = {
                    welcome: { name: 'Welcome', icon: 'üëã', color: 'border-[#377db8]', bg: 'bg-blue-50' },
                    backstage: { name: 'Backstage', icon: 'ü§ù', color: 'border-[#0a0e1a]', bg: 'bg-gray-50' },
                    parking: { name: 'Parking', icon: 'üöó', color: 'border-[#377db8]', bg: 'bg-blue-50' },
                    kids: { name: 'Kids', icon: 'üë∂', color: 'border-[#0a0e1a]', bg: 'bg-gray-50' }
                };

                if (escalas.length === 0) {
                    elements.escalasList.innerHTML = '<p class="text-gray-500 text-center py-8">Voc√™ ainda n√£o tem escalas agendadas.</p>';
                    return;
                }

                const html = escalas.map(escala => {
                    const config = teamConfig[escala.team];
                    const dateObj = new Date(escala.date + 'T' + escala.time);
                    const dateStr = dateObj.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    const timeStr = escala.time;
                    const eventNameDisplay = escala.eventName ? ` - ${escala.eventName}` : '';

                    return `
                        <div class="border-l-4 ${config.color} ${config.bg} p-4 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="text-3xl">${config.icon}</div>
                                    <div>
                                        <h3 class="font-bold text-lg">${config.name}${eventNameDisplay}</h3>
                                        <p class="text-sm text-gray-600">üìÖ ${dateStr}</p>
                                        <p class="text-sm text-gray-600">üïê ${timeStr}</p>
                                    </div>
                                </div>
                                <button class="delete-escala-btn text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition" data-escala-id="${escala.id}" title="Deletar escala">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

                elements.escalasList.innerHTML = html;

                // Event listeners para deletar
                document.querySelectorAll('.delete-escala-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const escalaId = e.currentTarget.dataset.escalaId;
                        showModal(
                            'Tem certeza que deseja remover esta escala?',
                            true,
                            () => deleteEscala(escalaId),
                            true
                        );
                    });
                });
            }

            // Carregar todas as escalas (vis√£o admin)
            async function loadAllEscalas() {
                try {
                    const { collection, getDocs } = window.firestoreMethods;
                    const querySnapshot = await getDocs(collection(window.firebaseDb, 'escalas'));
                    const escalas = [];
                    
                    querySnapshot.forEach((doc) => {
                        escalas.push({ id: doc.id, ...doc.data() });
                    });

                    // Agrupar por data e time
                    const grouped = {};
                    escalas.forEach(escala => {
                        const key = `${escala.date}_${escala.time}`;
                        if (!grouped[key]) {
                            grouped[key] = {
                                date: escala.date,
                                time: escala.time,
                                eventName: escala.eventName || '',
                                welcome: [],
                                backstage: [],
                                parking: [],
                                kids: []
                            };
                        }
                        grouped[key][escala.team].push(escala);
                    });

                    // Armazenar dados completos
                    allEscalasGrouped = grouped;
                    
                    // Atualizar filtro
                    updateVisaoGeralFilter(grouped);
                    
                    renderAdminView(grouped);
                } catch (error) {
                    console.error('‚ùå Erro ao carregar vis√£o geral:', error);
                }
            }
            
            // Atualizar filtro de Vis√£o Geral
            function updateVisaoGeralFilter(grouped) {
                const filter = elements.filterVisaoGeral;
                const dates = Object.keys(grouped).sort();
                
                filter.innerHTML = '<option value="">Todas as datas</option>';
                
                dates.forEach(key => {
                    const data = grouped[key];
                    const dateObj = new Date(data.date + 'T12:00:00');
                    const dateStr = dateObj.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = dateStr;
                    filter.appendChild(option);
                });
            }
            
            // Event listener para filtro de Vis√£o Geral
            elements.filterVisaoGeral.addEventListener('change', () => {
                const selectedKey = elements.filterVisaoGeral.value;
                if (selectedKey) {
                    const filtered = { [selectedKey]: allEscalasGrouped[selectedKey] };
                    renderAdminView(filtered);
                } else {
                    renderAdminView(allEscalasGrouped);
                }
            });

            // Deletar escala
            async function deleteEscala(escalaId) {
                try {
                    const { doc, deleteDoc } = window.firestoreMethods;
                    await deleteDoc(doc(window.firebaseDb, 'escalas', escalaId));
                    
                    console.log('‚úÖ Escala deletada com sucesso!');
                    showModal('Escala removida com sucesso!');
                    
                    // Recarregar escalas e atualizar dropdown
                    loadUserEscalas();
                    loadAllEscalas();
                } catch (error) {
                    console.error('‚ùå Erro ao deletar escala:', error);
                    showModal('Erro ao remover escala. Tente novamente.');
                }
            }

            // Renderizar vis√£o admin
            function renderAdminView(grouped) {
                const dates = Object.keys(grouped).sort();

                if (dates.length === 0) {
                    elements.adminView.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma escala cadastrada ainda.</p>';
                    return;
                }

                const html = dates.map(key => {
                    const data = grouped[key];
                    const dateObj = new Date(data.date + 'T' + data.time);
                    const dateStr = dateObj.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    const eventName = data.eventName ? ` - ${data.eventName}` : '';

                    return `
                        <div class="border border-gray-200 rounded-lg p-4" style="border: 2px solid #e5e5e5; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                            <h3 class="font-bold text-lg mb-3" style="color: #151b29;">üìÖ ${dateStr}${eventName} - üïê ${data.time}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                                <div class="bg-gray-50 p-3 rounded border-l-4" style="border-color: #151b29;">
                                    <h4 class="font-semibold mb-2" style="color: #151b29;">Welcome (${data.welcome.length})</h4>
                                    <div class="text-sm space-y-1">
                                        ${data.welcome.map(v => `<div>‚Ä¢ ${v.userName}</div>`).join('') || '<div class="text-gray-400">Ningu√©m escalado</div>'}
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded border-l-4" style="border-color: #151b29;">
                                    <h4 class="font-semibold mb-2" style="color: #151b29;">Backstage (${data.backstage.length})</h4>
                                    <div class="text-sm space-y-1">
                                        ${data.backstage.map(v => `<div>‚Ä¢ ${v.userName}</div>`).join('') || '<div class="text-gray-400">Ningu√©m escalado</div>'}
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded border-l-4" style="border-color: #151b29;">
                                    <h4 class="font-semibold mb-2" style="color: #151b29;">Parking (${data.parking.length})</h4>
                                    <div class="text-sm space-y-1">
                                        ${data.parking.map(v => `<div>‚Ä¢ ${v.userName}</div>`).join('') || '<div class="text-gray-400">Ningu√©m escalado</div>'}
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded border-l-4" style="border-color: #151b29;">
                                    <h4 class="font-semibold mb-2" style="color: #151b29;">Kids (${data.kids.length})</h4>
                                    <div class="text-sm space-y-1">
                                        ${data.kids.map(v => `<div>‚Ä¢ ${v.userName}</div>`).join('') || '<div class="text-gray-400">Ningu√©m escalado</div>'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                elements.adminView.innerHTML = html;
            }

            // Event Listeners
            elements.googleLoginBtn.addEventListener('click', loginWithGoogle);
            elements.saveEscalaBtn.addEventListener('click', saveEscala);

            // Monitorar autentica√ß√£o
            window.firebaseAuthMethods.onAuthStateChanged(window.firebaseAuth, (user) => {
                console.log('üîÑ Estado de auth mudou:', user?.email || 'deslogado');
                currentUser = user;

                if (user) {
                    updateUserUI(user);
                    showApp();
                    loadUserEscalas();
                    loadAllEscalas();
                } else {
                    showLogin();
                }
            });

            console.log('‚úÖ App inicializado');
        }
        
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    self.addEventListener('install', (e) => {
                        console.log('Service Worker instalado');
                        self.skipWaiting();
                    });
                    
                    self.addEventListener('activate', (e) => {
                        console.log('Service Worker ativado');
                        return self.clients.claim();
                    });
                    
                    self.addEventListener('fetch', (e) => {
                        e.respondWith(
                            fetch(e.request).catch(() => {
                                return new Response('Offline');
                            })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(reg => console.log('‚úÖ Service Worker registrado'))
                    .catch(err => console.error('‚ùå Erro ao registrar SW:', err));
            });
        }
        
        // Iniciar quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
